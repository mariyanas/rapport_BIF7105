---
title: "Analyse d’expression différentielle pour un séquençage de l’ARN avec edgeR"
author: "-"
date: "12 décembre 2025"
output:
  bookdown::pdf_document2:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
bibliography: references.bib 
csl: vancouver.csl
link-citations: true
toc-title: "Table des matières"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 100)
```

<!-- 
Révision critique d'un outil bioinformatique (ou package R): description de 
l'application et des jeux de données, de la problématique, des tests d'hypothèses 
et de la méthode statistique. Inclusion d'un exemple pratique.
-->

# Résumé
<!-- 
Un résumé de votre étude (1/2 page) 
-->
edgeR peut être utilisé pour l'identification des gènes exprimés différemment.
Nous allons procéder à une analyse des données issues d'une expérience de 
« *paired design RNA-seq* » de tissus tumoraux et non tumoraux (normaux). Nous ferons 
référence à une étude [@oralCarcinoma] portant sur des carcinomes épidermoïdes buccaux et des 
tissus normaux correspondants provenant de trois patients. Nous utiliserons edgeR 
pour détecter les gènes dont l'expression diffère entre ces deux types de tissus.

# Introduction
<!-- 
Une introduction avec les références pertinentes (1 page)
-->
<!-- 
- l’utilisation du package R edgeR pour l’identification de gènes différemment 
  exprimes entre deux classes de spécimen
- L’utilisation du package et les modèles statistiques utilisées pour la 
  normalisation des échantillons et l’analyse des différences d’expression 
  seront présentées. 
-->
Le séquençage de l'ARN (*RNA-seq*) est une méthode permettant de séquencer un 
ensemble de molécules d'ARN. Le séquençage d'ARN est utilisé pour 
déterminer quels segments d'ADN ont été transcrits en ARN et la quantité 
un gène est exprimé, afin de mieux comprendre la fonction des différents gènes [@RNA-seq].

[**edgeR**](https://bioconductor.org/packages/release/bioc/html/edgeR.html) est un 
package R conçu pour l'analyse d'expression différentielle des données 
de « *RNA-seq count* ». Il peut détecter des différences entre deux 
groupes ou plus quand au moins un des groupes a effectué des mesures répétées [@edgeRInfo].


# Méthodologie
<!-- 
Méthodologie (2 à 3 pages)
-->
## Introduction

## Téléchargement des données
Nous commonçons par charger les *libraries* pertinentes.
```{r message=FALSE}
library(org.Hs.eg.db)
library(limma)
library(edgeR)
```

Les données sont téléchargées du [**DOI**](https://doi.org/10.1371/journal.pone.0009317.s009) (*the Digital Object Identifier*).
Avant de lire les données, nous avons supprimé les colonnes qui n'étaient pas 
pertinentes pour notre étude. Nous avons également renommé certaines colonnes 
(`idRefSeq` à `RefSeqID`, `nameOfGene` à `Symbol`, `numberOfExons` à `NbrOfExons`).
```{r}
rawdata <- read.delim("TableS1.txt", check.names = FALSE, stringsAsFactors = FALSE)
head(rawdata, 3)
```

## Création d'un objet *DGEList*
Nous stockerons nos données dans l'objet *DGEList* pour faciliter leur manipulation.
Cet objet, conçu spécifiquement pour edgeR, peut être manipulé comme une liste. 
*DGEList* est un structure de données qui comprend toutes les composantes nécessaires 
(une matrice *counts* contenant les integer *counts*, un data-frame *samples* contenant 
des informations sur les échantillons et les librairies, et un data-frame *genes* 
contenant des annotations sur les gènes) dans un seul objet [@DGEList]. 

```{r}
y <- DGEList(counts = rawdata[,4:9], genes = rawdata[,1:3])
```

## Annotation
L'étude [@oralCarcinoma] a été réalisée en 2010 ; par conséquent, certains des `RefSeqID`s
ne sont plus utilisés. Nous filtrons les *RefSeq ID*s qui ne sont plus disponibles 
dans l'annotation actuelle du [**NCBI**](https://www.ncbi.nlm.nih.gov) (fournie par le package `org.Hs.eg.db`). 

```{r}
idfound <- y$genes$RefSeqID %in% mappedRkeys(org.Hs.egREFSEQ)
y <- y[idfound,]
dim(y) # 15534 sur 15668 RefSeqIDs sont retenus
```

*Entrez Gene ID*s sont les identifiants numériques uniques attribués aux 
gènes par le NCBI [@EntrezGeneID]. Pour chaque gène, *Entrez Gene* donne des détails tels que
le nom du gène et sa localisation chromosomique. Nous ajoutons les *Entrez Gene ID*s à l'annotation. 
```{r}
egREFSEQ <- toTable(org.Hs.egREFSEQ)
head(egREFSEQ, 3)
m <- match(y$genes$RefSeqID, egREFSEQ$accession)
y$genes$EntrezGene <- egREFSEQ$gene_id[m]
```

Ensuite, nous mettons à jour `symbol` en utilisant les *Entrez Gene ID*s.
```{r}
egSYMBOL <- toTable(org.Hs.egSYMBOL)
head(egSYMBOL, 3)
m <- match(y$genes$EntrezGene, egSYMBOL$gene_id)
y$genes$Symbol <- egSYMBOL$symbol[m]
head(y$genes, 3)
```

## Filtration 
Plusieurs transcrits *RefSeq* correspondent au même gène. Nous ne gardons qu'un seul 
transcrit *RefSeq* (celui avec le *count* le plus élevé) pour chaque gène.
```{r}
o <- order(rowSums(y$counts))
y <- y[o,]
d <- duplicated(y$genes$Symbol)
y <- y[!d,]
nrow(y)
```
Tous les transcrits se retrouvent au moins 50 fois dans au
moins un des 6 cas, donc ce n'est pas nécessaire de filtrer les gènes qui 
sont faiblement exprimés. 

Ensuite, nous recalculons la taille du `library`.
```{r}
y$samples$lib.size <- colSums(y$counts)
```

Et nous utilisons les *Entrez Gene ID*s comme les noms de lignes.
```{r}
rownames(y$counts) <- rownames(y$genes) <- y$genes$EntrezGene
y$genes$EntrezGene <- NULL
```

## Normalisation
La normalisation permet d'éliminer les effets techniques présents dans 
les données afin de minimiser l'impact des biais techniques sur les résultats [@TMM1; @TMM2]. 
Nous utilisons la fonction `normLibSizes()` qui utilise la normalisation *TMM* (*trimmed mean of M-values*) 
pour tenir compte des différences de composition entre les *libraries*.

```{r}
y <- normLibSizes(y)
y$samples
```

# Résultats et discussions
<!-- 
Résultats et discussions (2 à 3 pages)
-->

## Exploration des données
Nous voulons voir s'il existe des valeurs aberrantes ou d'autres corrélations 
dans notre échantillon. La fonction `plotMDS` produit un plot dans lequel les 
distances entre les échantillons représentent approximativement les différences d'expression [@plotMDS].\
Sur le plot (**figure \@ref(fig:fig1)**), la dimension 1 sépare les échantillons 
tumoraux des échantillons normaux et la dimension 2 correspond au numéro du patient. 
On peut observer que les échantillons non tumoraux sont proches les 
uns des autres, tandis que les échantillons tumoraux sont plus espacés. Donc, les 
échantillons tumoraux sont plus hétérogènes que les échantillons normaux.

```{r fig1, fig.cap = "plotMDS(y)", fig.width = 4, fig.height = 4, fig.align='center'}
plotMDS(y)
```

## Matrice de design
## Analyse des données
Nous voulons voir s'il existe des valeurs aberrantes ou d'autres corrélations 
dans notre échantillon. La fonction `plotMDS` produit un plot dans lequel les 
distances entre les échantillons représentent approximativement les différences d'expression [@plotMDS].
```{r, out.width = "70%", fig.align='center'}
plotMDS(y)
```

## Design matrix
Ensuite, nous voulons tester l'expression différentielle entre les tissus 
tumoraux et les tissus normaux chez les patients.
```{r}
Patient <- factor(c(8, 8, 33, 33, 51, 51))
Tissue <- factor(c("N", "T", "N", "T", "N", "T"))
data.frame(Sample = colnames(y), Patient, Tissue)
```


```{r}
design <- model.matrix(~Patient+Tissue)
rownames(design) <- colnames(y)
design
```

## Estimation de la dispersion
Pour comprendre la variabilité biologique, nous estimons la dispersion globale du *dataset*.
```{r fig.width = 4, fig.height = 4}
y <- estimateDisp(y, design, robust = TRUE)
y$common.dispersion
```
La racine carrée du *common dispersion*, `0.1613`, nous donne le BCV (biological coefficient of variation), `0.402`.
```{r}
sqrt(y$common.dispersion) # BCV
```
```{r plot2, fig.cap = "", out.width = "65%", fig.align='center'}
plotBCV(y)
```


## Differential expression
Nous utilison la fonction `glmFit` (fits negative binomial generalized log-linear model to each genes read count.)
```{r}
fit <- glmFit(y, design)
```
Ensuite, la fonction `glmLRT` est utilisée pour effecturer des 
*likelihood ratio tests* pour les différences entre le tissu tumoral et le tissu normal.
```{r}
lrt <- glmLRT(fit)
```
Nous utilisons la fonction `topTags` pour voir les résultats.
```{r}
topTags(lrt)
```

```{r}
colnames(design)
```

```{r}
o <- order(lrt$table$PValue)
cpm(y)[o[1:10],]
```

```{r, out.width = "75%", fig.align='center'}
summary(decideTests(lrt))
plotMD(lrt)
abline(h=c(-1, 1), col="blue")
```

## Gene Ontology Analysis
```{r}
go <- goana(lrt)
topGO(go, ont="BP", sort="Up", n=10, truncate=45)
```

```{r}
go <- goana(lrt)
topGO(go, ont="BP", sort="Down", n=10, truncate=45)
```

# Conclusion
<!-- 
Conclusion (1/2 page)
-->

# Références
<!-- 
Références en écartant les références de  Wikipedia (1 page maximum)
-->
---
nocite: '@*'
...

